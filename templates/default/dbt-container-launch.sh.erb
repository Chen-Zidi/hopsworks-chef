#!/usr/bin/env bash


DBT_HOME=$1

help() {
    echo ""
    echo "usage: $0 DBT_HOME"
    echo ""
    exit 1
}

if [ $# -ne 1 ]; then
  help
fi

if [ ! -d "$DBT_HOME" ]; then
    echo "DBT_HOME is not a valid directory: ${DBT_HOME}"
    exit 2
fi



IS_TLS=<%= node['hops']['tls']['enabled'] %>
NAMENODE_IP=<%= @namenode_fdqn %>
NAMENODE_PORT=<%= node['hops']['nn']['port'] %>
GLASSFISH_IP=<%= @glassfish_fdqn %>
GLASSFISH_PORT=<%= node['hopsworks']['internal']['port'] %>




docker run --rm --privileged \
      -v $DBT_HOME:$DBT_HOME:rw\
      -w="$DBT_HOME" \
      registry.service.consul:4443/dbt \
      /bin/bash launcher.sh



#docker run --rm -d --privileged --name $CONTAINER_NAME --cidfile=$PID_FILE\
#       --network=host \
#       --init \
#       -e "GIT_PATH=$GIT_HOME" \
#       -e "GIT_DATA_DIR=$GIT_HOME" \
#       -e "MATERIAL_DIRECTORY=$CERTS_DIR" \
#       -e "HADOOP_USERNAME=$HADOOP_USERNAME" \
#       -e "NAMENODE_IP=${NAMENODE_IP}" \
#       -e "NAMENODE_PORT=${NAMENODE_PORT}" \
#       -e "PROJECT_NAME=${PROJECT_NAME}" \
#       -e "GIT_COMMAND=${GIT_COMMAND}" \
#       -e "GIT_COMMAND_CONFIG=${GIT_COMMAND_CONFIG}" \
#       -e "COMMAND_LOGFILE=${COMMAND_LOGFILE}" \
#       -e "HOPSFS_LOGFILE=${HOPSFS_LOGFILE}" \
#       -e "CLIENT_CERTIFICATES_BUNDLE=${CLIENT_CERTIFICATES_BUNDLE}" \
#       -e "ROOT_CA_BUNDLE=${ROOT_CA_BUNDLE}" \
#       -e "CLIENT_KEY=${CLIENT_KEY}" \
#       -e "JWT_TOKEN_FILE=${JWT_TOKEN_FILE}" \
#       -e "EXECUTION_ID=${EXECUTION_ID}" \
#       -e "PROJECT_ID=${PROJECT_ID}" \
#       -e "GIT_USERNAME=${GIT_USERNAME}" \
#       -e "GIT_TOKEN=${GIT_TOKEN}" \
#       -e "HADOOP_GROUP=${HADOOP_GROUP}" \
#       -e "REPOSITORY_ID=${REPOSITORY_ID}" \
#       -e "GLASSFISH_IP=${GLASSFISH_IP}" \
#       -e "GLASSFISH_PORT=${GLASSFISH_PORT}" \
#       -e "IS_TLS=${IS_TLS}" \
#       -v $GIT_HOME:$GIT_HOME:rw\
#       -w="$GIT_HOME" \
#       $DOCKER_IMAGE &

exit $?
